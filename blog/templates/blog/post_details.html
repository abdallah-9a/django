{% extends "base.html" %}
{% load static %}
{% block page_content %}

<div class="container">
  <div class="mb-4 d-flex">
    <!-- Left content -->
    <div class="flex-grow-1 pe-4">
      <h2>{{ post.title }}</h2>
      <p class="text-muted">by {{ post.author }} ‚Ä¢ {{ post.publish_date }}</p>

      {% if post.category %}
        <p>
          Category:
          <a href="{% url 'category_details' post.category.id %}">
            {{ post.category.name }}
          </a>
        </p>
      {% endif %}

      {% if post.tags.exists %}
        <div class="mb-2">
          {% for tag in post.tags.all %}
            <span class="badge bg-secondary">#{{ tag.name }}</span>
          {% endfor %}
        </div>
      {% endif %}

      <hr />
      <p>{{ post.content|linebreaks }}</p>

      <!-- Like/Dislike Section -->
      {% if user.is_authenticated %}
        <div class="mt-3">
          <form method="post" action="{% url 'like_post' post.id %}" style="display:inline;">
            {% csrf_token %}
            <button class="btn btn-sm {% if user in post.likes.all %}btn-success{% else %}btn-outline-success{% endif %}">
              üëç {{ post.likes.count }}
            </button>
          </form>

          <form method="post" action="{% url 'dislike_post' post.id %}" style="display:inline;">
            {% csrf_token %}
            <button class="btn btn-sm {% if user in post.dislikes.all %}btn-danger{% else %}btn-outline-danger{% endif %}">
              üëé {{ post.dislikes.count }}
            </button>
          </form>
        </div>
      {% else %}
        <p class="mt-3">
          <a href="{% url 'login' %}">Login</a> to like or dislike this post.
        </p>
      {% endif %}

      <!-- Comments Section -->
      <div class="mt-5">
        <h5>Comments ({{ post.comments.count }})</h5>
        <hr />
        {% for comment in post.comments.all %}
          <div class="mb-3 border-bottom pb-2">
            <strong>{{ comment.author.username }}</strong>
            <small class="text-muted">on {{ comment.post_date }}</small>
            <p>{{ comment.content|linebreaks }}</p>
          </div>
        {% empty %}
          <p>No comments yet. Be the first to comment!</p>
        {% endfor %}

        {% if user.is_authenticated %}
          <h5 class="mt-4">Leave a Comment</h5>
          <form method="post" class="mt-3">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Post Comment</button>
          </form>
        {% else %}
          <p class="mt-4">
            <a href="{% url 'login' %}">Login</a> to leave a comment.
          </p>
        {% endif %}
      </div>
    </div>

    <!-- Right side: image -->
    {% if post.pic %}
      <div>
        <img src="{% static 'images/'|add:post.pic %}" alt="{{ post.title }}" width="150" class="img-fluid rounded" />
      </div>
    {% endif %}
  </div>
</div>

{% endblock page_content %}
